!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Chivatu=t()}(this,(function(){"use strict";class e{constructor(t={}){return e.instance?e.instance:(e.instance=this,this.subscribers=new WeakMap,this.observer,this.options=Object.assign({threshold:[0,1]},t),this.isSupported()&&(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?this._loadElement(e.target,e.intersectionRatio):this._unloadElement(e.target)})},this.options)),this)}isSupported(){return"IntersectionObserver"in window}add(e,t){e instanceof NodeList?e.forEach(e=>this.add(e,t)):e&&!this.subscribers.has(e)&&(this.subscribers.set(e,t),this.observer.observe(e))}_loadElement(e,t){const{once:s,onVisible:n}=this.subscribers.get(e);"function"==typeof n&&n.call(null,e,t),s&&this.observer.unobserve(e)}_unloadElement(e){const{onHidden:t}=this.subscribers.get(e);"function"==typeof t&&t.call(null,e)}}return e}));
